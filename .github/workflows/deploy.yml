name: Push-to-EC2
on:
  push:
    branches:
      - main
jobs:
  deploy:
    name: Deploy to Windows Server
    runs-on: windows-latest
    steps:
    
    - name: Checkout the files
      uses: actions/checkout@v3

    - name: Release
      run: |
        cd ./Drts.Lives.API/API
        dotnet publish -c Release
        cd ../../.github

    - name: Copy files with PowerShell
      run: |
        $source = "./Drts.Lives.API/API/bin/Release/net8.0/publish"
        $destination = "${{ secrets.SECRET_TARGET_DIR }}"
        
        if (!(Test-Path -Path $destination -IsValid)) {
          New-Item -ItemType Directory -Force -Path $destination
        }
        
        Copy-Item -Path $source -Destination $destination -Recurse -Force
