name: Push-to-EC2

on:
  issues:
    types:
      - closed

jobs:
  deploy:
    runs-on: windows-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2

    - name: Build and Publish
      run: |
        # Add your build and publish commands here
        # For example: dotnet publish -c Release -o publish

    - name: Copy files to AWS Windows Server
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SECRET_HOST }}
        username: ${{ secrets.SECRET_USER }}
        key: ${{ secrets.SECRET_SSH }}
        port: 5986 # Porta padr√£o para WinRM
        script: |
          $sourcePath = "./Drts.Lives.API/API/bin/Release/net8.0/publish/*"
          $destinationPath = "${{ secrets.SECRET_TARGET_DIR }}"

          Copy-Item -Path $sourcePath -Destination $destinationPath -Recurse -Force
